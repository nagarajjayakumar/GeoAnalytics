{"paragraphs":[{"user":"admin","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1504145149830_-565267077","id":"20170831-020549_226328997","dateCreated":"2017-08-31T02:05:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3121","text":"%spark2\n\nimport org.apache.spark.sql.SparkSession\nimport org.apache.spark.sql.SQLContext\nimport org.apache.hadoop.conf.Configuration\nimport org.apache.spark.rdd.RDD\nimport org.apache.spark.sql.{Row, SparkSession}\nimport org.geotools.data.{DataStoreFinder, Query}\nimport org.geotools.factory.CommonFactoryFinder\nimport org.geotools.filter.text.ecql.ECQL\nimport org.locationtech.geomesa.hbase.data.HBaseDataStore\nimport org.locationtech.geomesa.spark.{GeoMesaSpark, GeoMesaSparkKryoRegistrator}\nimport org.opengis.feature.simple.SimpleFeature\n\n\nsc.version\n\nval sparkSession = SparkSession\n      .builder()\n      .appName(\"testSpark\")\n      .config(\"spark.sql.crossJoin.enabled\", \"true\")\n      .config(\"zookeeper.znode.parent\", \"/hbase-unsecure\")\n      .config(\"spark.sql.autoBroadcastJoinThreshold\", 1024*1024*200)\n      .getOrCreate()\n\nval dataFrame = sparkSession.read\n      .format(\"geomesa\")\n      .options(Map(\"bigtable.table.name\" -> \"site_exposure_1M\"))\n      .option(\"geomesa.feature\", \"siteexposure_event\")\n      .load()\n      \nval sc = sparkSession.sparkContext\n//val sqlContext = new SQLContext(sc)\n\n//sqlContext.udf.register(\"WIDTH_BUCKET_1\" , com.hortonworks.gc.udf.WidthBucket.widthBucket _)   \n\nval featureTypeName = \"siteexposure_event\"\nval geom = \"geom\"\n\ndataFrame.createOrReplaceTempView(featureTypeName)\n\n   \n\n // val sqlQuery =\n   //   \"select event.site_id, sum(event.s_udf_met1), avg(event.s_udf_met1), sum (sitelossanalyzevent.gross_loss) from event  LEFT OUTER JOIN sitelossanalyzevent ON event.site_id = sitelossanalyzevent.site_id  where st_intersects(st_makeBBOX(-94.0, 31.0, -96.0, 29.0), geom) group by event.site_id\"\n   \n  val sqlQuery = \" select siteexposure_event.site_id from siteexposure_event  where st_intersects(st_makeBBOX(-91.0, 31.0, -96.0, 29.0), geom) limit 5 \"\n  \n   //val sqlQuery = \" select count(*) from sitelossanalyzevent \"\n   \n    val resultDataFrame = sparkSession.sql(sqlQuery)\n    \n    \n\n    resultDataFrame.show","dateUpdated":"2017-08-31T02:06:33+0000","dateFinished":"2017-08-31T02:06:38+0000","dateStarted":"2017-08-31T02:06:33+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nimport org.apache.spark.sql.SparkSession\n\nimport org.apache.spark.sql.SQLContext\n\nimport org.apache.hadoop.conf.Configuration\n\nimport org.apache.spark.rdd.RDD\n\nimport org.apache.spark.sql.{Row, SparkSession}\n\nimport org.geotools.data.{DataStoreFinder, Query}\n\nimport org.geotools.factory.CommonFactoryFinder\n\nimport org.geotools.filter.text.ecql.ECQL\n\nimport org.locationtech.geomesa.hbase.data.HBaseDataStore\n\nimport org.locationtech.geomesa.spark.{GeoMesaSpark, GeoMesaSparkKryoRegistrator}\n\nimport org.opengis.feature.simple.SimpleFeature\n\nres72: String = 2.1.1.2.6.1.0-129\n\nsparkSession: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@1235a315\n\ndataFrame: org.apache.spark.sql.DataFrame = [__fid__: string, portfolio_id: bigint ... 107 more fields]\n\nsc: org.apache.spark.SparkContext = org.apache.spark.SparkContext@1ae991e2\n\nfeatureTypeName: String = siteexposure_event\n\ngeom: String = geom\n\nsqlQuery: String = \" select siteexposure_event.site_id from siteexposure_event  where st_intersects(st_makeBBOX(-91.0, 31.0, -96.0, 29.0), geom) limit 5 \"\n\nresultDataFrame: org.apache.spark.sql.DataFrame = [site_id: string]\n+------------+\n|     site_id|\n+------------+\n| 51027614568|\n|102027614568|\n| 51027694716|\n|153027614568|\n|204027614568|\n+------------+\n\n"}]}},{"text":"%spark2\n","user":"admin","dateUpdated":"2017-08-31T02:05:53+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1504145153300_1163794480","id":"20170831-020553_2113241312","dateCreated":"2017-08-31T02:05:53+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3194"}],"name":"UseCase_3","id":"2CRVVKD4U","angularObjects":{"2CQ2GZDDE:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CQBK1CKC:shared_process":[],"2CNW8AS1D:shared_process":[],"2CMY8N527:shared_process":[],"2C4U48MY3_spark2:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}