{"paragraphs":[{"text":"%spark2\n\nimport org.apache.spark.sql.SparkSession\n\nsc.version\n\nval sparkSession = SparkSession\n      .builder()\n      .appName(\"testSpark\")\n      .config(\"spark.sql.crossJoin.enabled\", \"true\")\n      .config(\"zookeeper.znode.parent\", \"/hbase-unsecure\")\n      .getOrCreate()\n\nval dataFrame = sparkSession.read\n      .format(\"geomesa\")\n      .options(Map(\"bigtable.table.name\" -> \"siteexposure_1M\"))\n      .option(\"geomesa.feature\", \"event\")\n      .load()\n\nval siteLossAnalyzFeatureTypeName = \"sitelossanalyzevent\"\nval featureTypeName = \"event\"\nval geom = \"geom\"\n\ndataFrame.createOrReplaceTempView(featureTypeName)\n\n    val dataFrameSiteLossAnalyz = sparkSession.read\n      .format(\"geomesa\")\n      .options(Map(\"bigtable.table.name\" -> \"sitelossanalysis\"))\n      .option(\"geomesa.feature\", siteLossAnalyzFeatureTypeName)\n      .load()\n\n    dataFrameSiteLossAnalyz.createOrReplaceTempView(siteLossAnalyzFeatureTypeName)\n    dataFrameSiteLossAnalyz.printSchema\n    \n    val sqlQuery =\n      \"select count(*) from event \"\n\n\n    // Query against the \"event\" schema\n   // val sqlQuery =\n    //  \"select event.portfolio_id, sum(event.s_udf_met1), avg(event.s_udf_met1), sum (sitelossanalyzevent.gross_loss) from event  LEFT OUTER JOIN sitelossanalyzevent ON event.site_id = sitelossanalyzevent.site_id  where st_contains(st_makeBBOX(-94.0, 31.0, -96.0, 29.0), geom) group by event.portfolio_id\"\n\n   // val sqlQuery =\n     // \"select event.portfolio_id, sum(event.s_udf_met1), avg(event.s_udf_met1), sum (sitelossanalyzevent.gross_loss) from event  LEFT OUTER JOIN sitelossanalyzevent ON event.site_id = //sitelossanalyzevent.site_id    group by event.portfolio_id\"\n\n    val resultDataFrame = sparkSession.sql(sqlQuery)\n    \n    \n\n    resultDataFrame.show\n      ","user":"admin","dateUpdated":"2017-08-01T13:09:46+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":334,"optionOpen":false}}},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"\nimport org.apache.spark.sql.SparkSession\n\nres26: String = 2.1.1.2.6.1.0-129\n\nsparkSession: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@719feb2f\n\ndataFrame: org.apache.spark.sql.DataFrame = [__fid__: string, portfolio_id: bigint ... 107 more fields]\n\nsiteLossAnalyzFeatureTypeName: String = sitelossanalyzevent\n\nfeatureTypeName: String = event\n\ngeom: String = geom\n\ndataFrameSiteLossAnalyz: org.apache.spark.sql.DataFrame = [__fid__: string, portfolio_id: bigint ... 13 more fields]\nroot\n |-- __fid__: string (nullable = false)\n |-- portfolio_id: long (nullable = true)\n |-- analysis_id: long (nullable = true)\n |-- site_id: string (nullable = true)\n |-- account_id: string (nullable = true)\n |-- vendor_id: long (nullable = true)\n |-- model_id: long (nullable = true)\n |-- peril_id: long (nullable = true)\n |-- gross_loss: double (nullable = true)\n |-- damage_loss: double (nullable = true)\n |-- net_loss: double (nullable = true)\n |-- occ_id: long (nullable = true)\n |-- occ_ind: string (nullable = true)\n |-- const_id: long (nullable = true)\n |-- const_ind: string (nullable = true)\n\n\nsqlQuery: String = \"select count(*) from event \"\n\nresultDataFrame: org.apache.spark.sql.DataFrame = [count(1): bigint]\n+--------+\n|count(1)|\n+--------+\n| 3054397|\n+--------+\n\n"}]},"apps":[],"jobName":"paragraph_1501508957114_1423672006","id":"20170731-134917_1249912461","dateCreated":"2017-07-31T13:49:17+0000","dateStarted":"2017-08-01T13:09:46+0000","dateFinished":"2017-08-01T13:10:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3655"},{"text":"%dep\nz.addRepo(\"Spark Packages Repo\").url(\"https://repo.locationtech.org/content/repositories/geomesa-releases/\")\nz.load(\"org.locationtech.geomesa:geomesa-hbase_2.11:1.3.2\")\n\n\n      \n","user":"admin","dateUpdated":"2017-07-31T13:51:47+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Must be used before SparkInterpreter (%spark) initialized\nHint: put this paragraph before any Spark code and restart Zeppelin/Interpreter"}]},"apps":[],"jobName":"paragraph_1501509035513_1356279652","id":"20170731-135035_925714213","dateCreated":"2017-07-31T13:50:35+0000","dateStarted":"2017-07-31T13:51:47+0000","dateFinished":"2017-07-31T13:51:47+0000","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:3656"},{"text":"%dep\n","user":"admin","dateUpdated":"2017-07-31T13:51:47+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1501509107250_-1445569108","id":"20170731-135147_1185690260","dateCreated":"2017-07-31T13:51:47+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:3657"}],"name":"Naga_Jay_GeoAnalytics","id":"2CNU25ZRV","angularObjects":{"2CQ2GZDDE:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CQBK1CKC:shared_process":[],"2CNW8AS1D:shared_process":[],"2CMY8N527:shared_process":[],"2C4U48MY3_spark2:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}